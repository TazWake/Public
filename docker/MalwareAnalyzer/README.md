# Malware Analysis Tool for Incident Response

A comprehensive Docker-based malware analysis tool designed specifically for incident responders and digital forensic investigators. This tool automatically detects file types and runs appropriate analysis tools to quickly assess potentially malicious files during security incidents.

## üîç Overview

This containerized tool provides rapid, automated analysis of suspicious files by:
- **Auto-detecting file types** and running appropriate analysis tools
- **Generating comprehensive reports** with timestamps and detailed findings
- **Preserving evidence integrity** through read-only analysis
- **Providing immediate results** for incident response decision making

## üõ†Ô∏è Features

### Supported File Types & Analysis

#### Office Documents (.doc, .docx, .xls, .xlsx, .ppt, .pptx, .rtf)
- **oletools suite**: VBA macro analysis, object extraction, malicious indicator detection
- **Metadata extraction**: Author information, creation dates, modification history
- **String analysis**: Suspicious URLs, IP addresses, command patterns
- **Hash generation**: MD5, SHA1, SHA256, SHA512, SSDeep

#### PDF Files (.pdf)
- **PDF structure analysis**: Object identification, JavaScript detection
- **PDFID analysis**: Suspicious element identification
- **Metadata extraction**: Creator information, PDF version, security settings
- **String analysis**: Embedded URLs, suspicious patterns

#### Executable Files (.exe, .dll, .elf, .bin, .so)
- **PE analysis**: Header information, sections, imports/exports
- **ELF analysis**: Header details, symbols, sections
- **Static analysis**: String extraction, hex dumps, metadata
- **Hash generation**: Comprehensive hash suite including fuzzy hashing

#### General Files
- **File type identification**: Advanced file type detection with TrID
- **Binwalk analysis**: Firmware analysis, embedded file detection  
- **Metadata extraction**: EXIF data, file properties
- **String analysis**: ASCII and Unicode string extraction
- **Hex analysis**: Binary structure examination

### Security Tools Included

- **oletools**: Complete Office document analysis suite
- **binwalk**: Firmware and binary analysis
- **ClamAV**: Antivirus scanning with updated signatures
- **YARA**: Pattern matching and signature detection
- **exiftool**: Comprehensive metadata extraction
- **ssdeep**: Fuzzy hashing for similarity analysis
- **TrID**: Advanced file type identification
- **pefile**: PE format analysis for Windows executables
- **Various hash utilities**: MD5, SHA1, SHA256, SHA512

## üöÄ Quick Start

### Prerequisites
- Docker or Docker Desktop installed
- Basic command line familiarity

### Method 1: Using Docker Compose (Recommended)

1. **Navigate to the directory containing suspicious files:**
   ```bash
   cd /path/to/suspicious/files
   ```

2. **Copy the MalwareAnalyzer folder to your location or clone the repository:**
   ```bash
   # If copying from DFIR tools repo
   cp -r /path/to/dfir-tools/docker/MalwareAnalyzer .
   ```

3. **Run the analysis:**
   ```bash
   cd MalwareAnalyzer
   docker-compose up --build
   ```

4. **Check results in the `results` folder**

### Method 2: Using Docker Commands Directly

1. **Build the container:**
   ```bash
   docker build -t malware-analyzer .
   ```

2. **Run analysis on current directory:**
   ```bash
   docker run --rm -v "$(pwd):/analysis" malware-analyzer
   ```

3. **Run analysis on specific directory:**
   ```bash
   docker run --rm -v "/path/to/files:/analysis" malware-analyzer
   ```

## üìä Output Structure

The tool creates a `results` folder with timestamped analysis files:

```
results/
‚îú‚îÄ‚îÄ analysis_log_YYYYMMDD_HHMMSS.txt          # Complete activity log
‚îú‚îÄ‚îÄ analysis_summary_YYYYMMDD_HHMMSS.txt      # Executive summary
‚îú‚îÄ‚îÄ analyzed_files_YYYYMMDD_HHMMSS.txt        # List of processed files
‚îú‚îÄ‚îÄ office_analysis_filename_YYYYMMDD_HHMMSS.txt      # Office document results
‚îú‚îÄ‚îÄ pdf_analysis_filename_YYYYMMDD_HHMMSS.txt         # PDF analysis results
‚îú‚îÄ‚îÄ executable_analysis_filename_YYYYMMDD_HHMMSS.txt  # Binary analysis results
‚îú‚îÄ‚îÄ general_analysis_filename_YYYYMMDD_HHMMSS.txt     # General file analysis
‚îî‚îÄ‚îÄ antivirus_scan_filename_YYYYMMDD_HHMMSS.txt       # AV scan results
```

### Report Contents

Each analysis report contains:
- **File Information**: Basic file details, size, timestamps
- **Hash Analysis**: MD5, SHA1, SHA256, SHA512, SSDeep (if available)
- **Metadata**: EXIF data, document properties, creation info
- **Tool-Specific Analysis**: Appropriate for detected file type
- **Security Indicators**: Suspicious patterns, embedded objects, macros
- **Antivirus Results**: ClamAV scan findings

## üí° Usage Examples

### Analyze a Single Suspicious Email Attachment
```bash
# Copy attachment to analysis folder
cp suspicious_document.docx /tmp/analysis/
cd /path/to/MalwareAnalyzer
docker-compose up --build
```

### Batch Analysis of Multiple Files
```bash
# Copy all suspicious files to analysis directory
cp /evidence/suspicious_files/* /tmp/analysis/
cd /path/to/MalwareAnalyzer  
docker-compose up --build
```

### Incident Response Workflow
```bash
# Create analysis workspace
mkdir incident_20231201
cd incident_20231201

# Copy MalwareAnalyzer tools
cp -r /path/to/MalwareAnalyzer .

# Copy evidence files
cp /evidence/*.* .

# Run analysis
cd MalwareAnalyzer
docker-compose up --build

# Review results
ls -la results/
cat results/analysis_summary_*.txt
```

## üîß Advanced Usage

### Custom Analysis Directory
```bash
# Analyze files in specific directory
docker run --rm -v "/custom/path:/analysis" malware-analyzer
```

### Building Only (No Analysis)
```bash
# Just build the container without running analysis
docker-compose --profile build-only up
```

### Debugging/Interactive Mode
```bash
# Run container interactively for troubleshooting
docker run -it --rm -v "$(pwd):/analysis" malware-analyzer bash
```

## üõ°Ô∏è Security Considerations

### Safe Analysis Environment
- **Isolated container**: Analysis runs in isolated Docker container
- **No network access**: Container has no internet connectivity by default
- **Read-only analysis**: Original files are not modified
- **Host protection**: Malware cannot affect host system

### Evidence Integrity
- **Original files preserved**: Analysis is non-destructive
- **Hash verification**: All files are hashed for integrity verification
- **Timestamped logs**: Complete audit trail of analysis activities
- **RFC 3227 compliance**: Follows digital evidence handling best practices

### Recommendations
- Run on isolated analysis workstation
- Use dedicated VM or air-gapped system for highly suspicious files
- Regular ClamAV signature updates (container rebuild recommended weekly)
- Validate hash values before and after analysis

## üìã Troubleshooting

### Common Issues

#### "Permission denied" errors
```bash
# Ensure proper file permissions
chmod -R 755 /path/to/files
# Or run with elevated privileges
sudo docker-compose up --build
```

#### "No files found to analyze"
- Check that files are in the correct directory
- Ensure files aren't hidden (starting with '.')
- Verify volume mounts are correct

#### Analysis fails for specific file types
- Check the analysis log for specific error messages
- Some tools may fail on corrupted or heavily obfuscated files
- Review individual tool documentation for limitations

#### Container build failures
- Ensure internet connectivity for package downloads
- Check Docker daemon is running
- Try building with `--no-cache` flag

### Getting Detailed Logs
```bash
# View detailed container logs
docker-compose up --build | tee analysis_output.log

# Check specific tool errors
docker run -it --rm -v "$(pwd):/analysis" malware-analyzer bash
```

## üîÑ Updates and Maintenance

### Updating Signatures
```bash
# Rebuild container to get latest signatures
docker-compose build --no-cache
```

### Adding Custom Tools
1. Modify `Dockerfile` to include new tools
2. Update `analyze.sh` to integrate new analysis functions
3. Rebuild container

### Performance Optimization
- Use SSD storage for faster analysis
- Allocate more memory to Docker if analyzing large files
- Consider parallel analysis for multiple files

## ü§ù Contributing

To extend this tool:
1. Add new analysis functions to `analyze.sh`
2. Include new tools in `Dockerfile` 
3. Update documentation in `README.md`
4. Test with various file types
5. Follow DFIR best practices

## üìù License

This tool is part of the DFIR Tools Repository and is intended for legitimate security research, incident response, and digital forensic analysis only.

## ‚ö†Ô∏è Disclaimer

This tool is provided for defensive security and incident response purposes only. Users are responsible for:
- Compliance with applicable laws and regulations
- Proper handling of sensitive evidence
- Appropriate use in authorized investigations only
- Understanding tool limitations and potential false positives

Always validate findings with additional analysis methods and consult with cybersecurity experts when needed.